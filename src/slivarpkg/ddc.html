<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="author" content="Brent Pedersen" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <style>
    html,body { height: 100%; margin: 0px; padding: 0px; }
    .form-control.selectize-control {
        padding: 5px 6px 0px;
        height: unset !important;
    }
    .remove-single {
        color: gray !important;
        top: -1px !important;
        font-size: 20px !important;
    }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark p-0" style="background-color:#4b636e !important">
<a class="navbar-brand ml-2" href="https://github.com/brentp/slivar">slivar data-driven cut-offs</a>
</nav>

<div class="container-fluid h-100">
    <div class="row">
        <div class="col">
            <label for="select">choose a field to plot</label>
            <select name="select" id="select"></select>
        </div>
    </div>
    <div class="row h-50">
        <div class="col">
            <div class="h-100" id="plots"></div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div id="message"></div>
        </div>
    </div>
</div>

<script>
var nan = NaN; // hack to support json dumped with NaN values.
var traces = <INPUT_JSON>
</script>
<script>

var colors = ['rgba(55,126,184,0.7)', 'rgba(228,26,28,0.7)', 'rgba(77,175,74,0.7)', 'rgba(152,78,163,0.7)', 'rgba(255,127,0,0.7)', 'rgba(166,86,40,0.7)', 'rgba(247,129,191,0.7)']

var layout = {
    autosize: true,
    margin: {t: 30, pad: 0},
    xaxis: {
        title: "Mendelian violations",
        showspikes: true,
        spikethickness: 1,
	hoverformat: '.4f',
    },
    yaxis: {
        title: "Transmitted variants",
        showspikes: true,
        spikethickness: 1,
	hoverformat: '.4f',
    },
    hovermode: 'closest',
    showlegend: true,
    legend: {
        xanchor: "right",
        yanchor: "bottom",
        y: 1,
        x: 1,
        orientation: "h",
        borderwidth: 1,
        bordercolor: '#eeeeee'
    },
}

var div = document.getElementById("plots")
var sel = document.getElementById("select")
var msg = document.getElementById("message")


for(i=0;i<traces.length;i++){
	traces[i].mode = 'lines+markers';
	traces[i].type = 'scatter';
	traces[i].marker = {size: 4};
	var opt = document.createElement("option")
	opt.value = i
	opt.innerHTML = traces[i].name
	opt.selected = i == 0
	sel.appendChild(opt)

}

jQuery(sel).on("change", function() {
  var i = jQuery(this).val()
  var p = Plotly.newPlot(div, [traces[i]], layout)
  var field = jQuery("#select option:selected").text()
  div.on("plotly_hover", function(data) {
	  var p = data.points[0];
	  var falsepos = 100 * p.x
	  var truepos = 100 * p.y
	  var text = "remove <b>" + falsepos.toFixed(2) + "%</b> of mendelian violations (false-positives)<br/>retain <b>" + truepos.toFixed(2) + "%</b> of transmitted variants (true-positives)"
	  text += "<br/> by requiring <b>"
	  if(traces[i].abs ) {
		  text += "abs(" + field + ")"
	  } else {
		  text += field
	  }
	  text += (traces[i].lt ? "<" : ">")
	  // NOTE: this depends on the text not changing (e.g. <1.23 is the last thing in the text
	  var cutoff = p.text.split(traces[i].lt ? "<": ">");
	  text += cutoff[cutoff.length - 1]
	  msg.innerHTML = text + "</b>"
  })

}).trigger("change")



</script>

<p>


</body>
</html>
